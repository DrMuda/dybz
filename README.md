# dybz
爬第一版主的小说， 主要目的是移除源网站的广告干扰， 仅阅读，**没有下载功能**。

# 功能
1. 添加小说。输入小说的id， 即url上的数字，即可添加小说(添加到书架)， 但需要先在源网站找到该小说， 且需要手动输入小说名。该功能为初版功能， 懒得做查找小说功能想出来的的丐版， 建议用功能2的方法。
2. 查找小说。在搜索栏输入文字， 可查找小说， 查询到之后点击链接可自动添加到书架。
3. 阅读。在书架点击选择章节， 或者查找后点击链接， 跳转到章节页面， 继续点击章节链接即可进入阅读页面。阅读页面可跳转上、下一章， 选择当前章节分页， 导航栏默认在左边， 双击页面切换到右边。
4. 路线选择。原网站有很多条路线， 而且不同路线， 想通的小说id对应的实际小说不完全一致， 注意选择正确路线。 在设置中可以通过失联页面更新可用路线，选择其中的路线作为默认路线， 之后在阅读小说、查找小说、选择章节时都会使用默认路线。选择章节右上角可以锁定这本小说的路线， 在设置了这本小说的路线后， 选择章节和阅读小说则会使用此路线， 而不是默认路线。
5. 数据同步。首页左下角为上传数据、下载数据、设置， 在设置输入账号密码后， 可使用同步数据到服务器的功能。非常简陋， 直接输入账号密码， 然后上传， 如果此账号没有被占用， 直接创建此账号， 否则判断密码是否正确， 密码错误无法同步数据， 密码通过MD5加密保存在缓存， 如果再次输入密码， 则会提示是否覆盖已保存的密码， 没有密码找回功能。上传数据不会自动上传。 下载数据则是判断账号密码是否正确， 正确则下载并覆盖本地缓存里的数据， 每次进入首页都会尝试下载数据， 如果本地数据的最后更新时间比服务器数据的更晚， 则会提示是否真的要覆盖， 防止忘记上传。初版没设计好同步功能， 后续会考虑设计为完全自动同步的方式。
  > 此功能中的账号功能纯属娱乐, 本意是部署到服务器后可能可以分享给好友用， 所以就搞一搞吧， 但其实只有自己在用
6. 图片校正。 源网站是有很多使用图片替换文字的混淆操作， 非常影响排版， 所以有一个人工校正文字的功能， 在阅读页面， 直接点击图片， 就可以弹出弹窗， 输入文字， 再点击其他地方关掉弹窗， 此时该图片和文字就形成了映射关系， 可以正常显示文字了， 如果不小心输错了， 在设置里， 可以管理所有的字符， 查找刚才输错的字符即可再次修改。
7. ocr识别。 虽然需要矫正的文字不是很多(大概一两百多个)， 但大多时候， 人工校正还是太烦了， 所以引入ocr识别， 使用的百度的ocr接口， 在设置里输入ocr的token， 开启ocr， 那么在爬取小说时， 如果有未匹配、识别的图片， 则会调用接口识别此图片， 将识别结果和图片建立映射关系。 开启后， 时刻留意你的 **ocr使用量** ， 我只能做到尽可能少调用接口， 但如果从零开始识别原网站的所有图片， 可能免费的次数会用完。

# 待做事项
1. 重构前端。项目前端用vue2 + elementui写的， 说实话， 实在不太喜欢使用vue2， 虽然强行拉上了ts一起， 但仍然感觉不舒服， 而且本项目完成时， 经验太少， 代码写的很乱很糟糕， 后端代码量较少， 勉强用ts救了一下， 但前端是真难顶了， 考虑用react或者vue3重构一波前端
2. 同步数据功能做成完全自动形式
3. 优化爬取逻辑。后端使用puppeteer爬取， 目前的逻辑是每次请求， 根据页面链接打开浏览器， 打开页面， 跳转链接， 等待页面完成， 关闭页面， 关闭浏览器。 这个过程每个请求都这么做， 其实打开关闭浏览器、页面可以只做一次， 跳转链接、等待页面完成 在同一个页面完成，等待页面完成 还有 绕过反爬虫的操作， 也是可以一段时间内只做一次， 优化这些应该能大幅提升爬取速度
4. 下载功能。 这个很可能会放弃， 现在爬一个页面就需要几秒时间， 至少需要做了第3项才会考虑， 即便如此， 爬取一整本小说估计也会耗时很久， 而且可能会被检测到频繁请求， 然后被 ban ip， 那就糟糕了。