"use strict";(self["webpackChunkdybz"]=self["webpackChunkdybz"]||[]).push([[551],{8551:function(t,e,a){a.r(e),a.d(e,{default:function(){return v}});var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"select-chapter"},[e("div",{staticClass:"header"},[e("h4",[t._v(t._s(t.novel.name))]),e("div",{staticStyle:{display:"flex","align-items":"center","font-size":"14px"}},[e("span",[t._v("锁定路线:")]),e("el-select",{staticClass:"m-2",attrs:{placeholder:"Select",size:"small"},on:{change:t.changeChanel},model:{value:t.novel.chanel,callback:function(e){t.$set(t.novel,"chanel",e)},expression:"novel.chanel"}},t._l(t.chanelList,(function(t,a){return e("el-option",{key:t,attrs:{label:"路线"+(a+1),value:t}})})),1)],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"list"},[e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.chapterList,showHeader:!1,stripe:!0,size:"small"},on:{"row-click":t.toReadNovel}},[e("el-table-column",{attrs:{prop:"title",label:t.novel.name}})],1)],1),e("div",{staticClass:"page-nav-contain"},[e("div",{staticClass:"page-nav"},[e("el-button",{staticClass:"page-btn",attrs:{size:"small"},on:{click:t.toPrev}},[t._v("上一页")]),e("el-button",{staticClass:"page-btn",attrs:{size:"small"},on:{click:t.toNext}},[t._v("下一页")])],1),e("div",{staticClass:"page-nav"},[e("el-input-number",{staticClass:"page-input",attrs:{min:1,max:t.amountPage,size:"small"},model:{value:t.inputPage,callback:function(e){t.inputPage=e},expression:"inputPage"}}),e("el-button",{staticClass:"page-btn",attrs:{size:"small"},on:{click:t.toPage}},[t._v("跳转")])],1),e("div",{staticStyle:{"text-align":"center",width:"100%"}},[t._v("共"+t._s(t.amountPage)+"页")])])])},l=[],i=(a(7658),a(8499)),n=a(676),r=a(6797),o=a.n(r),c=a(9248),u=a(6369);u["default"].use(i.Button),u["default"].use(i.InputNumber),u["default"].use(i.Table),u["default"].use(i.TableColumn),u["default"].use(i.Select),u["default"].use(i.Option),u["default"].use(i.Loading.directive);const h={chanel:"",firstChapter:{title:"",url:""},history:{title:"",url:""},id:"",key:"",name:"",url:""};var d=u["default"].extend({components:{Table:i.Table,Button:i.Button,InputNumber:i.InputNumber,Select:i.Select,Option:i.Option},data(){const t=localStorage.getItem("chanelList");return{novel:JSON.parse(JSON.stringify(h)),novelId:this.$route.query.id,chapterList:[],chanelList:t?JSON.parse(t):["www.banzhu222.xyz","www.5diyibanzhu.xyz","www.diyibanzhuvip6.xyz","www.diyibanzhu111.xyz"],currPage:1,inputPage:1,loading:!1,amountPage:0,isFirt:!1}},mounted(){let t=[];try{t=JSON.parse(`{"data":${localStorage.getItem("novelList")}}`).data||[]}catch(a){t=[]}let e=JSON.parse(JSON.stringify(h));t.forEach((t=>{t.id.toString()===this.novelId.toString()&&(e=t)})),e.chanel=e.chanel||localStorage.getItem("chanel")||"",this.novel=e,this.load()},methods:{async load(){this.loading=!0;try{let t=await this.getWebData();"string"===typeof t&&this.initContent(t)}catch(t){console.error(t),(0,i.Message)({showClose:!0,message:"出错了",type:"error",duration:1e3})}this.loading=!1},changeChanel(){let t=[];try{t=JSON.parse(`{"data":${localStorage.getItem("novelList")}}`).data||[]}catch(e){t=[]}t=t.map((t=>t.id.toString()===this.novelId.toString()?this.novel:t)),localStorage.setItem("novelList",JSON.stringify(t)),localStorage.setItem("lastUpdate",o()().format("YYYY-MM-DD HH:mm:ss")),this.load()},toPrev(){this.currPage>1&&(this.currPage-=1,this.inputPage=this.currPage,this.load())},toNext(){this.currPage<this.amountPage&&(this.currPage+=1,this.inputPage=this.currPage,this.load())},toPage(){this.currPage=this.inputPage,this.load()},toReadNovel(t){this.$store.commit("setCurrNovelChanel",this.novel.chanel),this.$router.push({name:"ReadNovel",path:"/ReadNovel",query:{id:this.novelId,url:t.url}})},getWebData(){return new Promise((t=>{c.bR(this.novel.url,this.currPage,this.novel.chanel).then(async function(e){const a=await e.data;t(a)}.bind(this)).catch((t=>{(0,i.Message)({showClose:!0,message:"加载失败",type:"error",duration:1e3}),this.loading=!1,console.error("failed",t)}))}))},initContent(t){t=t.replace(/\r\n/g,""),t=t.replace(/\n/g,""),t=t.replace(/\/images\/jipin-default.jpg/g,""),t=t.replace(/src=/g,"my-src=");let e=new RegExp(/(第[0-9]+\/[0-9]+页)/,"g").exec(t)?.[0]||"";e=e.split("/")?.[1]||"",e=e.replace("页",""),this.amountPage=parseInt(e||"0");const a=document.createElement("div");let s=new RegExp('<body class="cover".*</body>').exec(t)?.[0];s=s?.replace("body","div");const l=(0,n.Z)(s)[0];l&&a?.appendChild(l),this.chapterList=[];const i=a.getElementsByClassName("mod block update chapter-list")[1].getElementsByTagName("a");for(let n=0;n<i.length;n+=1)this.chapterList.push({url:i[n].getAttribute("href")||"",title:i[n].innerText});if(!this.isFirt){this.isFirt=!0;let t=[];try{t=JSON.parse(`{"data":${localStorage.getItem("novelList")}}`).data||[]}catch(r){t=[]}t=t.map((t=>t.id.toString()===this.novelId.toString()?{...t,firstChapter:{title:this.chapterList[0].title,url:this.chapterList[0].url.replace(".html","")}}:t)),localStorage.setItem("novelList",JSON.stringify(t)),localStorage.setItem("lastUpdate",o()().format("YYYY-MM-DD HH:mm:ss"))}a.remove()}}}),g=d,p=a(1001),m=(0,p.Z)(g,s,l,!1,null,null,null),v=m.exports}}]);