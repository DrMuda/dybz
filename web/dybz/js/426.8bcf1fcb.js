"use strict";(self["webpackChunkdybz"]=self["webpackChunkdybz"]||[]).push([[426],{7426:function(t,e,s){s.r(e),s.d(e,{default:function(){return A}});var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"choose-novel"},[e("div",{staticClass:"novel-list"},[t._l(t.novelList,(function(s){return[s.id?e("novel-list-item",{key:s.key,attrs:{item:s,onChange:t.onChange,onDel:t.onDel}}):t._e()]})),e("div",{staticClass:"add-btn",on:{click:t.onAdd}},[t._v("添加")])],2),e("div",{staticClass:"sync-btn-contain"},[e("i",{staticClass:"el-icon-upload2 sync-btn pull",staticStyle:{"font-size":"25px"},on:{click:t.pushCache}}),e("i",{staticClass:"el-icon-download sync-btn push",staticStyle:{"font-size":"25px"},on:{click:t.pullCache}})])])},i=[],n=(s(7658),s(6369)),l=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"novel-card"},[e("div",{staticClass:"position-head"},[e("div",{staticClass:"novel-info"},[e("el-input",{attrs:{size:"small"},on:{change:t.onNameOrUrlChange},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),e("el-input",{attrs:{size:"small"},on:{change:t.onNameOrUrlChange},model:{value:t.url,callback:function(e){t.url=e},expression:"url"}})],1),e("div",{staticClass:"operation"},[e("el-popconfirm",{attrs:{title:"确定？"},on:{cancel:null,confirm:t.onDelBtnClick},scopedSlots:t._u([{key:"reference",fn:function(){return[e("a",{staticClass:"link",staticStyle:{color:"red"}},[t._v("删除书籍")])]},proxy:!0}])}),e("router-link",{staticClass:"link",attrs:{to:`/SelectChapter?id=${t.id}&url=${t.url}&name=${t.name}`}},[t._v("选择章节")])],1)]),e("div",{staticClass:"link-list"},[e("router-link",{staticClass:"link",attrs:{to:t.toHistory()},on:{click:t.setChanel}},[t._v("上次读到："+t._s(t.history.title))]),e("router-link",{staticClass:"link",attrs:{to:t.toFirst()},on:{click:t.setChanel}},[t._v("重头开始读："+t._s(t.firstChapter.title))])],1)])},o=[],r=s(8499);n["default"].use(r.Input),n["default"].use(r.Popconfirm);var h=n["default"].extend({components:{Input:r.Input,Popconfirm:r.Popconfirm},data(){return{id:this.item?.id||"",name:this.item?.name||"",url:this.item?.url||"",history:this.item?.history||"",firstChapter:this.item?.firstChapter||""}},props:{item:Object,onChange:Function,onDel:Function},mounted(){this.item?.chanel||this.item&&(this.item.chanel=localStorage.getItem("chanel"))},methods:{onDelBtnClick(){this.onDel?.(this.id)},onNameOrUrlChange(){this.onChange?.(this.url,this.name,this.id)},toHistory(){return this.history.url?{path:"/ReadNovel",name:"ReadNovel",query:{url:this.history.url,id:this.id}}:{path:"/SelectChapter",query:{id:this.id}}},toFirst(){return this.firstChapter.url?{path:"/ReadNovel",name:"ReadNovel",query:{url:this.firstChapter.url,id:this.id}}:{path:"/SelectChapter",query:{id:this.id}}},setChanel(){this.$store.commit("setCurrNovelChanel",this.item?.chanel)}}}),c=h,u=s(1001),d=(0,u.Z)(c,l,o,!1,null,"dd3409d6",null),m=d.exports,g=s(5711),p=s(6797),C=s.n(p),f=s(9248);async function y(t){let e={};const s=Object.keys(t);for(let a=1;a<=s.length;a+=1){const i=s[a];e[i]=t[i],a%100===0&&(await f.iH({data:{imgAndChar:e}}),e={})}f.iH({data:{imgAndChar:e}})}async function v(t){let e={};const s=Object.keys(t);for(let a=0;a<s.length;a+=1){const i=s[a];e[i]=t[i],(a+1)%300===0&&(await f.iH({data:{oldNewKey:e}}),e={})}f.iH({data:{oldNewKey:e}})}function S(t=1,e=100){f.tn(t,e).then((t=>{const{status:s,imgAndChar:a,page:i,totalPage:n}=t.data||{};"success"===s&&(g.Z.set({...g.Z.get(),...a}),i<n&&S(i+1,e))}))}function I(t=1,e=300){f.s4(t,e).then((t=>{const{status:s,oldNewKey:a,page:i,totalPage:n}=t.data||{};if("success"===s){let t={};try{t=JSON.parse(localStorage.getItem("oldNewKey")||"{}")}catch(l){t={}}t={...t,...a},localStorage.setItem("oldNewKey",JSON.stringify(t)),i<n&&I(i+1,e)}}))}var k={pushCache(){return new Promise((t=>{(0,r.Message)({type:"info",message:"上传数据中...",duration:1e3,showClose:!0});let e=g.Z.get(),s={};s&&Object.keys(e).forEach((t=>{e[t].char&&(s[t]=e[t])}));let a=[],i="",n={};try{a=JSON.parse(localStorage.getItem("novelList")||"[]")}catch(l){a=[]}try{n=JSON.parse(localStorage.getItem("oldNewKey")||"{}")}catch(l){n={}}try{i=localStorage.getItem("ocrToken")||""}catch(l){i=""}f.iH({data:{user:{novelList:a,ocrToken:i}}}).then((e=>{"success"===e.data.status?(0,r.Message)({type:"success",message:"上传成功",duration:1e3,showClose:!0}):(0,r.Message)({type:"error",message:"上传失败",duration:1e3,showClose:!0}),y(s),v(n),t()}),(e=>{(0,r.Message)({type:"error",message:"上传失败",duration:1e3,showClose:!0}),console.error(e),y(s),v(n),t()}))}))},pullCache(){return new Promise((t=>{f.AV().then((async e=>{const{status:s,user:a}=e.data||{};if("success"===s){const e=C()(localStorage.getItem("lastUpdate")),s=C()(a.lastUpdate);let i=!1;await new Promise((t=>{e.isValid()&&s.isValid()&&e>s?r.MessageBox.alert(`<p>本地记录较新，确定更新?</p>\n                                    <p>本地：${localStorage.getItem("lastUpdate")}</p>\n                                    <p>云端：${a.lastUpdate}</p>`,"更新提示",{confirmButtonText:"确定",type:"warning",dangerouslyUseHTMLString:!0}).then((()=>{i=!0,t()})).catch((()=>{(0,r.Message)({type:"info",message:"推荐将本地记录上传",duration:1e3,showClose:!0}),t()})):(i=!0,t())})),i&&(localStorage.setItem("novelList",JSON.stringify(a.novelList)),localStorage.setItem("ocrToken",a.ocrToken),localStorage.setItem("lastUpdate",a.lastUpdate),(0,r.Message)({type:"info",message:"已更新本地记录",duration:1e3,showClose:!0}),t())}else(0,r.Message)({type:"error",message:"更新失败",duration:1e3,showClose:!0});S(1,100),I(1,300),t()}))}))}},L=n["default"].extend({components:{NovelListItem:m},data(){return{novelList:[],updateTag:!0}},mounted(){try{this.novelList=JSON.parse(`{"data":${localStorage.getItem("novelList")}}`).data||[],this.novelList=this.novelList.map((t=>({...t,key:Math.random()})))}catch(t){this.novelList=[]}sessionStorage.getItem("isFirst")&&"true"!==sessionStorage.getItem("isFirst")||(this.pullCache(),sessionStorage.setItem("isFirst","false"))},methods:{onChange(t,e,s){if(s){const a=this.novelList.findIndex((t=>t.id.toString()===s.toString()));a>-1?this.novelList[a]={...this.novelList[a],url:t,name:e}:this.novelList.push({...this.novelList[a],id:(new Date).getTime(),url:t,name:e}),localStorage.setItem("novelList",JSON.stringify(this.novelList)),localStorage.setItem("lastUpdate",C()().format("YYYY-MM-DD HH:mm:ss"))}},onAdd(){this.novelList||(this.novelList=[]),this.novelList.push({id:(new Date).getTime(),url:"",name:"书籍名称",history:{title:"无历史记录",url:null},firstChapter:{title:"查找章节",url:null},chanel:localStorage.getItem("chanel")||"www.banzhu222.xyz"}),localStorage.setItem("novelList",JSON.stringify(this.novelList)),localStorage.setItem("lastUpdate",C()().format("YYYY-MM-DD HH:mm:ss"))},onDel(t){const e=this.novelList.findIndex((e=>e.id===t));e>-1&&(this.novelList.splice(e,1),localStorage.setItem("novelList",JSON.stringify(this.novelList)),localStorage.setItem("lastUpdate",C()().format("YYYY-MM-DD HH:mm:ss")))},pushCache(){k.pushCache()},pullCache(){k.pullCache().then((()=>{try{this.novelList=JSON.parse(localStorage.getItem("novelList")||"[]").map((t=>({...t,key:Math.random()})))}catch(t){console.error(t),this.novelList=[]}}))}}}),w=L,N=(0,u.Z)(w,a,i,!1,null,"ca738abe",null),A=N.exports},5711:function(t,e,s){function a(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}s.d(e,{Z:function(){return n}});class i{constructor(){a(this,"imgAndChar",{}),this._refresh()}_refresh(t){if(t)localStorage.setItem("imgAndChar",JSON.stringify(this.imgAndChar));else{const t=localStorage.getItem("imgAndChar");if(t)try{this.imgAndChar=JSON.parse(t)}catch(e){this.imgAndChar={},localStorage.setItem("imgAndChar","{}")}else this.imgAndChar={},localStorage.setItem("imgAndChar","{}")}}get(){return this.imgAndChar}getByKey(t){return this.imgAndChar[t]}set(t){this.imgAndChar=t,this._refresh(!0)}setByKey(t,e){this.imgAndChar[t]=e,this._refresh(!0)}setCharByKey(t,e){this.imgAndChar[t]||(this.imgAndChar[t]={char:null,img:null}),this.imgAndChar[t].char=e,this._refresh(!0)}setImgByKey(t,e){this.imgAndChar[t]||(this.imgAndChar[t]={char:null,img:null}),this.imgAndChar[t].img=e,this._refresh(!0)}}var n=new i}}]);