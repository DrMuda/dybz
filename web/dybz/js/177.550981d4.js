"use strict";(self["webpackChunkdybz"]=self["webpackChunkdybz"]||[]).push([[177],{9177:function(t,e,n){n.r(e),n.d(e,{default:function(){return u}});var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"set-char"},[e("div",{staticClass:"filter-bar"},[e("div",{staticClass:"input-contain"},[e("span",{staticStyle:{flex:"0 0 auto"}},[t._v("筛选：")]),e("el-input",{attrs:{size:"small"},on:{change:t.onFilterInputChange},model:{value:t.filterInput,callback:function(e){t.filterInput=e},expression:"filterInput"}})],1),e("div",{staticClass:"btn-contain"},[e("el-button",{on:{click:function(e){return t.filter("wasSet")}}},[t._v("已设值")]),e("el-button",{on:{click:function(e){return t.filter("notSet")}}},[t._v("未设值")]),e("el-button",{on:{click:function(e){return t.filter("all")}}},[t._v("所有值")]),e("el-button",{on:{click:function(e){return t.filter("notNormal")}}},[t._v("异常值")])],1)]),e("div",{staticClass:"list"},t._l(Object.keys(t.imgAndChar),(function(n){return e("div",{key:n,class:"item "+n},[e("img",{attrs:{src:t.imgAndChar[n].img||"#"}}),e("el-input",{attrs:{size:"small"},on:{change:e=>{t.onChange(n,e)}},model:{value:t.imgAndChar[n].char,callback:function(e){t.$set(t.imgAndChar[n],"char",e)},expression:"imgAndChar[id].char"}})],1)})),0)])},r=[],i=n(8499),s=n(5711),o=n(3089),h=n(639),c=n(6369);c["default"].use(i.Button),c["default"].use(i.Input);var l=c["default"].extend({components:{Input:i.Input,Button:i.Button},data(){return{imgAndChar:s.Z.get(),originImgAndChar:s.Z.get(),filterInput:""}},mounted(){let t=!1;Object.keys(this.imgAndChar).forEach((e=>{this.imgAndChar[e].img||(t=!0)})),(async()=>{if(t){let t=(0,i.Message)({message:"正在下载图片...",type:"info",duration:1e3,showClose:!0});await(0,o.Z)((()=>{})),t.close(),(0,i.Message)({message:"下载完成",type:"info",duration:1e3,showClose:!0}),this.$forceUpdate()}setTimeout((async()=>{this.imgAndChar=s.Z.get(),this.originImgAndChar=s.Z.get(),await(0,h.Z)(),this.$forceUpdate()}),10)})()},methods:{onChange(t,e){this.imgAndChar[t].char=e?.[0]||"",this.originImgAndChar[t].char=e?.[0]||"",s.Z.setCharByKey(t,e?.[0]||"")},onFilterInputChange(){if(this.filterInput){const t={};Object.keys(this.originImgAndChar).forEach((e=>{const n=this.originImgAndChar[e];n.char&&n.char.indexOf(this.filterInput)>-1&&(t[e]=n)})),this.imgAndChar=t}else this.filter("all")},filter(t){let e={};switch(this.filterInput="",t){case"wasSet":Object.keys(this.originImgAndChar).forEach((t=>{const n=this.originImgAndChar[t];n.char&&(e[t]=n)}));break;case"notSet":Object.keys(this.originImgAndChar).forEach((t=>{const n=this.originImgAndChar[t];n.char||(e[t]=n)}));break;case"notNormal":Object.keys(this.originImgAndChar).forEach((t=>{const n=this.originImgAndChar[t],a=n.char;a&&"string"===typeof a&&(a.search(/[0-9]|[a-z]|[A-Z]/g)>-1||a.length>1)&&(e[t]=n)}));break;default:e=this.originImgAndChar;break}this.imgAndChar=e}}}),g=l,d=n(1001),m=(0,d.Z)(g,a,r,!1,null,"ad490e3a",null),u=m.exports},5711:function(t,e,n){function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{Z:function(){return i}});class r{constructor(){a(this,"imgAndChar",{}),this._refresh()}_refresh(t){if(t)localStorage.setItem("imgAndChar",JSON.stringify(this.imgAndChar));else{const t=localStorage.getItem("imgAndChar");if(t)try{this.imgAndChar=JSON.parse(t)}catch(e){this.imgAndChar={},localStorage.setItem("imgAndChar","{}")}else this.imgAndChar={},localStorage.setItem("imgAndChar","{}")}}get(){return this.imgAndChar}getByKey(t){return this.imgAndChar[t]}set(t){this.imgAndChar=t,this._refresh(!0)}setByKey(t,e){this.imgAndChar[t]=e,this._refresh(!0)}setCharByKey(t,e){this.imgAndChar[t]||(this.imgAndChar[t]={char:null,img:null}),this.imgAndChar[t].char=e,this._refresh(!0)}setImgByKey(t,e){this.imgAndChar[t]||(this.imgAndChar[t]={char:null,img:null}),this.imgAndChar[t].img=e,this._refresh(!0)}}var i=new r},639:function(t,e,n){var a=n(5711),r=n(9248),i=n(8499);const s=10;e["Z"]=async()=>{const t=localStorage.getItem("ocr"),e=localStorage.getItem("ocrToken");if(t&&"no"!==t&&e){(0,i.Message)({message:"正在使用百度ocr， 注意使用量",type:"warning",duration:1e3,showClose:!0});const n=a.Z.get(),o=Object.keys(n);for(let i=0;i<o.length;i+=1){const s=o[i],h=n[s];!h.char&&h.img&&await new Promise(((i,o)=>{const c=document.createElement("canvas"),l=c.getContext("2d");if(c.setAttribute("height","25"),c.setAttribute("width","25"),l){l.fillStyle="#fff",l.fillRect(0,0,25,25);const g=new Image;g.src=h.img||"",g.onload=()=>{l.drawImage(g,0,0),r.XG({url:t,method:"post",params:{access_token:e,image:c.toDataURL()}}).then((t=>{a.Z.setCharByKey(s,t.data.words_result?.[0]?.words),n[s]={...n[s],char:t.data.words_result?.[0]?.words},i()}),(()=>{o(),console.error("error")})).catch((t=>{o(),console.error(t)}))}}}))}await new Promise((t=>{setTimeout((()=>{t()}),1e3/s)}))}else t&&"no"!==t&&!e&&(0,i.Message)({message:"无access_token",type:"error",duration:1e3,showClose:!0})}},3089:function(t,e,n){n(7658);var a=n(5711),r=n(9564),i=n.n(r),s=n(639),o=n(9248);e["Z"]=t=>new Promise(((e,n)=>{let r=a.Z.get();const h=[];Object.keys(r).forEach((e=>{e.includes(".png")&&h.push(new Promise(((n,a)=>{o.Pk(e).then((async a=>{const s=await a.data;if("string"===typeof s){const n=i()(s.replace("data:text/html","data:image/png"));r[n]={char:"",img:s.replace("data:text/html","data:image/png")},t instanceof Function&&t(e,n),delete r[e]}n(`success:${e}`)}),(()=>{a(`fail:${e}`)}))})))})),Promise.allSettled(h).then((()=>{a.Z.set(r),(0,s.Z)(),e()}),(()=>{n()}))}))}}]);